## Protect your content

You will now add captcha verification to your website. Captcha is used as a form of security to protect a page from unwanted activity or bots. It works similar to a password, except that it is generated randomly every single time.
<iframe src="https://staging-editor.raspberrypi.org/en/embed/viewer/comic-character-complete" width="100%" height="800" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen> </iframe>

The captcha section you will create contains five elements.
+ a "text" type `<input> `field that is used to compare to the captcha generated
+ a refresh icon that generates a new captcha when clicked
+ the captcha image that will log you into the website
+ a "submit" type `<input> `field that submits the form and makes sure that the captcha inputted matches the captcha generated
+ a `<p>` element that notifies us if there's a match or not 

#### Add captcha to your website

--- task ---

Open index.html.

Add a captcha section with a `<section>` tag above the `<header>` element. 

Add the attributes `id="captchaSection"`, `class="center-container"` and the function attribute `onload="generate()"`.

Continue by adding a `<h1> `element and a `<p>`element below it with information about the page.

This will show a welcoming message for the comic book creator, explaining the purpose of the captcha.

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 13-17
---
    <section id="captchaSection" class="center-container" onload="generate()">
      <h1>Login</h1>
      <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
      </p>
    </section>

--- /code ---

--- /task ---

To be able to submit the captcha, you need a form input element to check against the code generated by your `"generate()"` function.

--- task ---

Add a `<span>` element with the attributes `id="user-input"` and `class="inline"`

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 18-20
---
    <section id="captchaSection" class="center-container" onload="generate()">
      <h1>Login</h1>
      <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
      </p>
      <span id="user-input" class="inline">
        
      </span>
      </section>

--- /code ---

--- /task ---

--- task ---

Also add a text input element with the attributes type="text" `id="submit"` and placeholder=" Enter Captcha code".

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 18-20
---
    <section id="captchaSection" class="center-container" onload="generate()">
      <h1>Login</h1>
      <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
      </p>
    <span id="user-input" class="inline">
      <input type="text" id="submit" placeholder=" Enter Captcha code" />
    </span>
    </section>

--- /code ---

--- /task ---

--- task ---

Add another `<span>` element that contains the attributes for the symbol to reset the captcha code.

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 21-23
---
    <section id="captchaSection" class="center-container" onload="generate()">
      <h1>Login</h1>
      <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
      </p>
      <span id="user-input" class="inline">
        <input type="text" id="submit" placeholder=" Enter Captcha code" />
      </span>
      <span class="inline" onclick="generate()">
        <i class="fas fa-sync"></i>
      </span>
    </section>

--- /code ---

--- /task ---

--- task ---

Add another `<span>` element that contains the styles for showing the captcha code.

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 24-25
---
    <section id="captchaSection" class="center-container" onload="generate()">
      <h1>Login</h1>
      <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
      </p>
      <span id="user-input" class="inline">
        <input type="text" id="submit" placeholder=" Enter Captcha code" />
      </span>
      <span class="inline" onclick="generate()">
        <i class="fas fa-sync"></i>
      </span>
      <span id="image" class="inline" selectable="False">
      </span>
      </section>

--- /code ---

--- /task ---

-- task ---

Add a `Submit` button so your users can submit their captcha text.

Also add a `<p>` element with the attribute `id="key"`.

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 22-25
---
      <section id="captchaSection" class="center-container" onload="generate()">
        <h1>Login</h1>
        <p>Welcome Comic book creator, enter the captcha to unlock exclusive content!
        </p>
        <span id="user-input" class="inline">
          <input type="text" id="submit" placeholder=" Enter Captcha code" />
        </span>
        <span class="inline" onclick="generate()">
        <i class="fas fa-sync"></i>
        </span>
        <span id="image" class="inline" selectable="False"> </span>
        <input type="Submit" id="btn" onclick="printmsg()" />
        <p id="key"></p>
      </section>

--- /code ---

--- /task ---

**Click the Run button** to see your changes.

+ A new section will appear above your navbar.
+ You will be able to type into the text input field.
+ There will be no captcha code generated yet and the `Submit` button will not work.

**Debug step:**
+ Ensure all your `class` and `id` attributes are correct.
+ Ensure there are spaces between classes.
+ Ensure you have added parentheses `()` on your `onclick` action.

### Create a login check

Well done, you have created a form for your users to engage with your captcha check.

You can use local storage preferences to check if your user has already completed your captcha check so they are given access.

-- task ---

Open `script.js`

Add the captcha check function provided below to your file.


--- code ---
---
language: js
filename: script.js
line_numbers: true
line_number_start: 80
line_highlights: 81-99
---
    // Captcha check Function
    let captcha;

    document.addEventListener("DOMContentLoaded", function () {
    // Check if the user has already successfully logged in during this session
    const isLoggedIn = localStorage.getItem('isLoggedIn');

    if (isLoggedIn === 'true') {
        // If already logged in, hide the captcha section and show the successful login section
        document.getElementById("captchaSection").style.display = 'none';
        document.getElementById("successfulLogin").style.display = 'block';
    } else {
        // If not logged in, show the captcha section
        document.getElementById("captchaSection").style.display = 'block';
        document.getElementById("successfulLogin").style.display = 'none';

        // Call generate function to load captcha
        generate();
    }
});
  
--- /code ---

--- /task ---

### Create captcha characters randomly

--- task ---

Add the random character generation function to your file.

--- code ---
---
language: js
filename: script.js
line_numbers: true
line_number_start: 101
line_highlights: 102-121
---
    // Captcha Function
   function generate() {
    // Clear old input
    document.getElementById("submit").value = "";

    // Access the element to store the generated captcha
    captcha = document.getElementById("image");
    let uniquechar = "";

    const randomchar = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

    // Generate captcha for length of 5 with random character
    for (let i = 0; i < 5; i++) {
        uniquechar += randomchar.charAt(
            Math.random() * randomchar.length
        );
    }

    // Store generated input
    captcha.innerHTML = uniquechar;
}
  
--- /code ---

--- collapse ---

---
title: How does random character generation work?
---



--- /collapse ---

--- /task ---

### Update the captcha based on user response

--- task ---

Add a function to print a message to the user if they enter the captcha incorrectly.

--- code ---
---
language: js
filename: script.js
line_numbers: true
line_number_start: 123
line_highlights: 124-139
---
    // Captcha Function
   
function printmsg() {
    const usr_input = document.getElementById("submit").value;

    // Check whether the input is equal to the generated captcha or not
    if (usr_input == captcha.innerHTML) {
        document.getElementById("key").innerHTML = "Matched";
        // Store the successful login state in local storage
        localStorage.setItem('isLoggedIn', 'true');
        document.getElementById("captchaSection").style.display = 'none';
        document.getElementById("successfulLogin").style.display = 'block';
        generate();
    } else {
        document.getElementById("key").innerHTML = "not Matched";
        generate();
    }
}
  
--- /code ---

--- /task ---

--- task ---

Open `index.html`.

--- code ---
---
language: html
filename: index.html
line_numbers: true
line_number_start: 13
line_highlights: 22-25
---
     <div id="successfulLogin" style="display: none;">
        <header class="header">
            <a href="index.html" class="logo">Pi Comics</a>
            <nav class="navbar" id="nav">
                <a href="index.html">HOME</a>
                <a href="comicbook.html">CREATE COMIC</a>
            </nav>

--- /code ---

--- /task ---

### Clear local storage preferences

--- task ---

Add a function to logout and clear the user's local preference so they can see the captcha every time they logout.

--- code ---
---
language: js
filename: script.js
line_numbers: true
line_number_start: 58
line_highlights: 68-69
---
    // Captcha Function
   
// Function to logout and clear local storage
function logout() {
    localStorage.removeItem('isLoggedIn');
    document.getElementById("captchaSection").style.display = 'block';
    document.getElementById("successfulLogin").style.display = 'none';
    generate();
}
  
--- /code ---

--- /task ---

Fantastic effort! You have created an interactive website where users can create their own superhero character. You have also secured your content. 

Check your understanding of the project using the reflection quiz on the next step.